---
layout: post
title: 如何选择前端架构：服务器端HTML vs. JS部件 vs.单页Web应用
---

来自：[CSDN](http://www.csdn.net/article/2013-06-08/2815681-Server-side-HTML-JS-Widgets-Single-Page-Web-Apps)

> 本文作者根据自己的实际经验，对服务器端HTML、JS部件、单页Web应用进行了很好的总结与分析，以及谈到了开发人员在选择架构时需要考虑的几大因素。

这是作者在GOTO芝加哥会议上发表的一篇关于“前端架构的前世今生”的主题演讲，下面是笔者对原文的翻译：

在近日举行的GOTO芝加哥会议上，我发表“前端架构的前世今生”为主题的演讲。在过去的10个月，我体验到了前端架构所带来的欢乐与痛苦，下面我将和大家分享我的使用心得。

##如何选择架构？##

我们可能会通过weibo或者看到一群年轻小伙正在讨论某个架构，然后就做出选择。但这似乎有点不太靠谱，我们应该使用更科学的方法来做决定，并且需要搞清楚，对前端工程师来说，什么才是最重要的。

下面，我们来谈谈用户在选择架构时，会关心哪些东西：

+ 易用性：可以做他们想做的事情，快速直观
+ 相关性：可以标记或链接网站
+ 可搜索性/共享性：用户可以分享他们正在使用的社交网络，并且可以在Google上发现它（这对用户增长是很重要的）。
+ 更多的功能，更少的bug

那么作为开发人员，又会在乎哪些属性：

+ 开发效率：开发人员希望能够快速地迭代、尝试新的东西和实现功能。
+ 可测性：开发者希望代码不容易被打破，他们不愿意花时间去维护腐朽、易碎的产品。
+ 性能：开发者希望服务器能够做出快速响应，并且服务最小的请求数。用户无需花费不必要的等待时间。

当程序员灵活运用自己满意的架构时，心情也会不一样，产品也能得到快速改进和提升，这样用户的满意度也随即会提升。

下面让我们对比几个架构，当我们回顾这些架构时，你会发现一些本质的区别。

##服务器端HTML(“Web 1.0”)##

![服务器端HTML](http://cms.csdnimg.cn/article/201306/07/51b1a7056723e.jpg)

站在用户角度来看，其可用性较差，用户很难在短时间里做出太多交互。但在相关性、共享和可搜索上却有一定的好处。

但作为开发者，我不喜欢该架构，为什么？
所有的数据都与HTML捆绑在一起，当我想把JS文件拽进去时，它就变得很混乱。
此外，它还关系到特定的后端语言，如果我们想改变语言（转换成Scala/Play），就必须重写表现层。
如果开发者要想以优雅地方式使用它，模板倒是个不错地选择。
但要想实现跨语言，还是不大可能。

##JS部件##

![js部件](http://cms.csdnimg.cn/article/201306/07/51b1a71ac5c6a.jpg)

在我们的项目中，对HTML里的一些特定属性（比如data-coursera-forum-threads-widget），我们使用DIV，
然后引用一个widgets.js文件，再把这些DIV层插入到Backbone视图里。

采用这种方法可以创建动态的接口，并且可以实现实时更新，如果我们有服务器端URL和散列状态，我们就可以进行很好地相关。
但我们不能使内容在小部件中可共享和可搜索，因为bots（机器人）根本不理解JS。

就开发者而言，通常会创建API来使用JS小部件，并且对API进行很好的测试，这也意味着同一个数据，
开发者可以更容易地创建不一样的前端效果，开发者也可以重用相同的API。

与此同时，开发者需要花费更多的时间来测试前端，因为用户可以通过交互序列改变状态，这样bug就会不定时地出现。

##单页Web应用##

![单页Web应用](http://cms.csdnimg.cn/article/201306/07/51b1a786ca805.jpg)

在www.course.org上，我们为每个URL提供相同的HTML文件，HTML文件里仅包含require.js文件和一个加载route.js的调用。这些route文件把URL映射到Backbone的视图上，然后依靠Backbone route来弄清哪个视图需要加载，并且使用HTM5的历史API来管理历史（在老版本的浏览器上使用带后退的哈希技术）。

在使用JS小部件和单页Web应用时，我体会到了许多相同的优点和缺点，但还是有些实质的不同。由于缺乏完整的页面加载，我们可以有一个潜在快速地用户体验，但它很难去做一些简单的事情，比如内链（在老版本的浏览器上会以双散列结束）或者监听window.onunload事件。这样，可搜索性就变差了，而用户发现并分享课程描述是非常重要的，所以我们编写了一个“及时渲染器”，使用Selenium去渲染HTML和服务。

对于开发者而言，由于我们的Web应用中存在交叉routes， 我们的测试又必须检测不同的routes序列，所以测试会变得比以往复杂。

##到底哪一个才是最好的呢？##

目前，单页Web应用还存在一点风险，然而，随着时间的推移，风险会变得越来越少。

就JS widgets和单页Web应用而言，到底该采取哪个方法要依情形来定。在www.course.org上，我们希望给老师们增加课堂的把控和灵活性，让所有课程更好的组合起来，这也是我们为什么要构建widgets的原因所在。同样，我们也希望学生能够在网站上面浏览更多的课程，并且我们知道每一个页面的需求是什么样，因此采用单页Web应用更能满足我们的需求，给我们带来更多的灵感。二者唯一的区别就在routes和widgets文件上（映射URL vs.转换DIV），所以，无论我们是使用widget还是单页应用，都可以很容易地创建的视图层和模型层。

各位开发人员，在实际应用中，你们又是如何选择的呢？不妨和我们一起分享下它们的利与弊吧！
