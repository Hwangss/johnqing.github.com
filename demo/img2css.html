<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
	<style type="text/css">
		* {margin: 0;padding: 0;}
		body {font-size: 12px; margin: 10px; font-family: simsun; background: #fff;}
		p { height: 12px;}
		#img{
			width: 1px; height: 1px; overflow: hidden; line-height: 999em; font-size: 0px;
		}
		#preCode{
			display: block;
			width: 200px;
			height: 200px;
		}
	</style>
</head>
<body>
<div id="img"></div>
<input type='file' id="fileBtn">
<code id="preCode"></code>
<script type="text/javascript">
	var fileNode = document.getElementById('fileBtn');
	var imgStyleNode = document.getElementById('img');
	var preCode = document.getElementById('preCode');
	
	var canvas = document.createElement('canvas');
	var canvas2d = canvas.getContext('2d');
	var imgUpload = new Image();

	var colorArr = [];

	// 文件上传
	fileNode.onchange = function(){
		var fileReader = new FileReader();
		fileReader.readAsDataURL(fileNode.files[0]);
		// 载入后才能有值
		fileReader.onload = function() {
			imgUpload.src = fileReader.result;
		};
	}
	// 监听载入
	imgUpload.onload = function(){
		colorArr = [];

		var imgWidth = imgUpload.width;
		var imgHeight = imgUpload.height;

		canvas.width = imgWidth;
		canvas.height = imgHeight;
		// 载入canvas
		canvas2d.drawImage(imgUpload, 0, 0);
		// 通过getImageDate获取图片数据
		var imgData = canvas2d.getImageData(0, 0, imgWidth, imgHeight);
		var imgColorData = imgData.data;
		var imgDataWidth = imgData.width;
		var imgDataHeight = imgData.height;

		for (var i = 0; i < imgDataHeight; i++) {
			for (var j = 0; j < imgDataWidth; j++) {
				// 每个像素点的rgba其index应该在像素点的索引值上乘以4
				var index = (j + imgDataWidth * i) * 4;
				// rgb
				var r = imgColorData[index + 0];
				var g = imgColorData[index + 1];
				var b = imgColorData[index + 2];
				// rgb array
				var rgbArr = [r, g, b];
				// box shadow
				var boxShadow = (j+1) + 'px ' + (i + 1) + 'px 0 rgb(' + rgbArr.join(',') + ')'; 

				colorArr.push(boxShadow);
			};
		};
		imgStyleNode.style.boxShadow = colorArr.join(',');
		preCode.innerHTML = colorArr.join(',');
		imgData = colorArr = null;
	}


</script>
</body>
</html>
