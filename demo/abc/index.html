<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta name="format-detection" content="telephone=no" />
	<title>360安全支付</title>
	<link rel="stylesheet" href="css/base.css"/>
	<link rel="stylesheet" href="css/call_charge.css?v=1"/>
</head>
<body>

<section class="m-fm-box" data-type="form">
		<div class="field m-yzm">
			<label>验证码已发送到您的手机：</label>
			<div class="m-inp-box s-cl-green">13506020602</div>
		</div>

		<div class="field">
			<div class="m-display-box">
				<div class="m-inp-box-flex">
					<input type="text" placeholder="请输入验证码" data-validate="yzm" class="c-f-text">
				</div>
				<div class="u-btn-grey" data-type="getSms">获取短信验证码</div>
			</div>
			<div class="tips">验证码不能为空</div>
		</div>

		<div class="field submit-btn">
			<input type="button" class="u-btn-green" data-btns="submit" value="立即支付">
		</div>
</section>

<script src="https://pay.360.cn/resource/js/lib/zepto.min.js"></script>
<script>

	var fmNode = $('[data-type=form]');
	var nodes = fmNode.find('[data-validate]');

	/**
	 * 验证码校验
	 * @returns {boolean}
	 */
	function validate(){
		for(var i=0, len=nodes.length; i<len; i++){
			var item = $(nodes[i]);
			var v = item.val();

			if(!v){
				item.parents('.field').addClass('error');
				return false;
			}

			if(v.length){
				return false;
			}

		};

		return true;
	}

	/**
	 * 提交
	 */
	$('[data-btns=submit]').on('click', function(){
		// 前端校验
		if(!validate()) return;

		$.getJSON(url, function(data){

		});
	});
	/**
	 * 定时器的类
	 * @param el
	 * @param s
	 * @constructor
	 */
	function Timer(el, s){
		this.el = el;
		this.total = s;
		this.timer = null;
	}
	Timer.prototype.start = function(){
		var self = this;
		var total = self.total;
		self.setText(total);
		self.timer = setInterval(function(){
			total--;
			if(!total){
				clearInterval(self.timer);
				self.el.removeClass('u-btn-disable');
				self.el.text('重新获取');
				return;
			}
			self.setText(total);

		}, 1000);
	}
	Timer.prototype.setText = function(s){
		this.el.addClass('u-btn-disable');
		this.el.text(s + '秒后重新获取');
	}
	// 获取短信验证码
	var smsBtn = $('[data-type=getSms]');
	var t = new Timer(smsBtn, 8);
	t.start();
	smsBtn.on('click', function(){
		var el = $(this);
		if(el.hasClass('u-btn-disable')) return false;
		// 重写调用
		t.start();
	});


</script>
</body>
</html>